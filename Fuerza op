local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

-- Configuración
local PET_NAME = "Swift Samurai"
local ROCK_NAME = "Rock5M"
local PROTEIN_EGG_NAME = "ProteinEgg"
local PROTEIN_EGG_INTERVAL = 30 * 60
local REP_INTERVAL = 0.01 -- cada cuánto mandar un rep en modo activo
local ACTIVE_DURATION = 8 -- segundos de reps
local REST_DURATION = 3 -- segundos sin hacer nada
local lastProteinEggTime = 0

-- Activador global
getgenv()._AutoRepFarmEnabled = not getgenv()._AutoRepFarmEnabled
if getgenv()._AutoRepFarmEnabled then
    warn("[Auto Rep Farm] ACTIVADO")
else
    warn("[Auto Rep Farm] DESACTIVADO")
    return
end

-- Funciones
local function equipPet()
    if LocalPlayer:FindFirstChild("petsFolder") and LocalPlayer.petsFolder:FindFirstChild("Unique") then
        for _, pet in pairs(LocalPlayer.petsFolder.Unique:GetChildren()) do
            if pet.Name == PET_NAME then
                ReplicatedStorage.rEvents.equipPetEvent:FireServer("equipPet", pet)
                break
            end
        end
    end
end

local function eatProteinEgg()
    if LocalPlayer:FindFirstChild("Backpack") then
        for _, item in pairs(LocalPlayer.Backpack:GetChildren()) do
            if item.Name == PROTEIN_EGG_NAME then
                ReplicatedStorage.rEvents.eatEvent:FireServer("eat", item)
                break
            end
        end
    end
end

local function hitRock()
    local rock = workspace:FindFirstChild(ROCK_NAME)
    if rock and HumanoidRootPart then
        HumanoidRootPart.CFrame = rock.CFrame * CFrame.new(0, 0, -5)
        ReplicatedStorage.rEvents.hitEvent:FireServer("hit", rock)
    end
end

-- Función para spamear reps durante cierto tiempo
local function spamRepsFor(duration)
    local start = tick()
    while tick() - start < duration and getgenv()._AutoRepFarmEnabled do
        if LocalPlayer:FindFirstChild("muscleEvent") then
            LocalPlayer.muscleEvent:FireServer("rep")
        end
        task.wait(REP_INTERVAL)
    end
end

-- Bucle principal
task.spawn(function()
    equipPet()

    while getgenv()._AutoRepFarmEnabled do
        -- Usar proteína si ya pasó el tiempo
        if tick() - lastProteinEggTime >= PROTEIN_EGG_INTERVAL then
            eatProteinEgg()
            lastProteinEggTime = tick()
        end

        -- Golpear roca cada 10 segundos
        if tick() % 10 < 0.2 then
            hitRock()
        end

        -- Fase activa: 8 segundos de reps
        spamRepsFor(ACTIVE_DURATION)

        -- Fase de descanso: 2 segundos
        task.wait(REST_DURATION)
    end
end)
